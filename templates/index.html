<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vPrompt - åœ–ç‰‡/å½±ç‰‡æç¤ºè©ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- HEIC support library - using multiple CDN sources for reliability -->
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script>
        // Fallback check for heic2any library
        if (typeof heic2any === 'undefined') {
            console.warn('heic2any library failed to load from primary CDN, trying fallback...');
            var script = document.createElement('script');
            script.src = 'https://unpkg.com/heic2any@0.0.4/dist/heic2any.min.js';
            script.onload = function() {
                console.log('heic2any loaded successfully from fallback CDN');
            };
            script.onerror = function() {
                console.error('Failed to load heic2any from both CDNs');
            };
            document.head.appendChild(script);
        } else {
            console.log('heic2any library loaded successfully from primary CDN');
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>vPrompt - åœ–ç‰‡/å½±ç‰‡æç¤ºè©ç”Ÿæˆå™¨</h1>
        <form method="POST" enctype="multipart/form-data" id="promptForm">
            <label>é¸æ“‡æç¤ºé¡å‹ï¼š</label>
            <select name="prompt_type">
                <option value="image" {% if prompt_type == 'image' %}selected{% endif %}>åœ–ç‰‡</option>
                <option value="video" {% if prompt_type == 'video' %}selected{% endif %}>å½±ç‰‡</option>
            </select>
            <br>
            <label>è¼¸å‡ºèªè¨€ï¼š</label>
            <select name="output_lang">
                <option value="en" {% if output_lang == 'en' %}selected{% endif %}>è‹±èª</option>
                <option value="zh-tw" {% if output_lang == 'zh-tw' or output_lang == 'zh-TW' %}selected{% endif %}>ç¹é«”ä¸­æ–‡</option>
                <option value="zh-cn" {% if output_lang == 'zh-cn' or output_lang == 'zh-CN' %}selected{% endif %}>ç°¡é«”ä¸­æ–‡</option>
                <option value="ja" {% if output_lang == 'ja' %}selected{% endif %}>æ—¥èª</option>
                <option value="ko" {% if output_lang == 'ko' %}selected{% endif %}>éŸ“èª</option>
                <option value="fr" {% if output_lang == 'fr' %}selected{% endif %}>æ³•èª</option>
                <option value="de" {% if output_lang == 'de' %}selected{% endif %}>å¾·èª</option>
                <option value="es" {% if output_lang == 'es' %}selected{% endif %}>è¥¿ç­ç‰™èª</option>
            </select>
            <br>
            <label>ä¸Šå‚³åœ–ç‰‡ï¼š</label>
            <div class="drop-zone" id="dropZone">
                <div class="drop-zone-content" id="dropZoneContent">
                    <div class="drop-zone-icon">ğŸ“</div>
                    <div class="drop-zone-text">
                        <p><strong>æ‹–æ”¾åœ–ç‰‡è‡³æ­¤è™•</strong></p>
                        <p>æˆ– <span class="drop-zone-browse">é»æ“Šç€è¦½</span></p>
                        <p class="drop-zone-formats">æ”¯æ´ PNGã€JPGã€JPEGã€GIFã€HEIC</p>
                    </div>
                </div>
                <div class="drop-zone-preview" id="dropZonePreview" style="display:none;">
                    <img id="previewImage" src="" alt="é è¦½åœ–ç‰‡">
                    <div class="preview-overlay">
                        <div class="preview-info" id="previewInfo"></div>
                        <button type="button" class="remove-image" id="removeImage">Ã—</button>
                    </div>
                </div>
            </div>
            <input type="file" name="image" id="fileInput" accept="image/*,.heic,.heif" style="display:none;">
            <br>
            <label>é¸æ“‡æ™‚é–“ï¼š</label>
            <input type="time" name="time" min="00:00" max="23:59" value="{{ time }}">
            <br>
            <label>å ´æ™¯ï¼š</label>
            <select name="scene" id="sceneSelect">
                <option value="æˆ¶å¤–" {% if scene == 'æˆ¶å¤–' %}selected{% endif %}>æˆ¶å¤–</option>
                <option value="å®¤å…§" {% if scene == 'å®¤å…§' %}selected{% endif %}>å®¤å…§</option>
                <option value="å…¶å®ƒ" {% if scene == 'å…¶å®ƒ' or not scene %}selected{% endif %}>å…¶å®ƒ</option>
            </select>
            <input type="text" name="custom_scene" id="customSceneInput" placeholder="ä¾‹å¦‚ï¼šæ£®æ—ã€æµ·é‚Šã€å’–å•¡å»³ã€è¾¦å…¬å®¤..." style="display:inline;" value="{{ custom_scene }}">
            <br>
            <label>ä¸»è§’ï¼š</label>
            <select name="character" id="characterSelect">
                <option value="ç”·" {% if character == 'ç”·' %}selected{% endif %}>ç”·</option>
                <option value="ç”·å­©" {% if character == 'ç”·å­©' %}selected{% endif %}>ç”·å­©</option>
                <option value="è€äººï¼ˆç”·ï¼‰" {% if character == 'è€äººï¼ˆç”·ï¼‰' %}selected{% endif %}>è€äººï¼ˆç”·ï¼‰</option>
                <option value="å¥³" {% if character == 'å¥³' %}selected{% endif %}>å¥³</option>
                <option value="å¥³å­©" {% if character == 'å¥³å­©' %}selected{% endif %}>å¥³å­©</option>
                <option value="è€äººï¼ˆå¥³ï¼‰" {% if character == 'è€äººï¼ˆå¥³ï¼‰' %}selected{% endif %}>è€äººï¼ˆå¥³ï¼‰</option>
                <option value="å…¶å®ƒ" {% if character == 'å…¶å®ƒ' or not character %}selected{% endif %}>å…¶å®ƒ</option>
            </select>
            <input type="text" name="custom_character" id="customCharacterInput" placeholder="ä¾‹å¦‚ï¼šæƒ…ä¾¶ã€æ”å½±å¸«ã€å­¸ç”Ÿã€å•†äººã€è—è¡“å®¶ã€..." style="display:inline;" value="{{ custom_character }}">
            <br>
            <label>é¡å¤–æè¿°ï¼š</label>
            <input type="text" name="extra_desc" placeholder="æè¿°é¢¨æ ¼ã€æƒ…ç·’ã€å‹•ä½œã€é‹é¡ã€è§’åº¦ç­‰... ä¾‹å¦‚ï¼šè¿½è¹¤é¡é ­ã€æº«æš–çš„é™½å…‰ã€å¾©å¤é¢¨æ ¼ã€å¿«æ¨‚çš„è¡¨æƒ…ã€ä½è§’åº¦æ‹æ”" value="{{ extra_desc }}">
            <br>
            <div class="tip" style="background-color: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #4CAF50;">
                <strong>ğŸ’¡ æç¤ºï¼š</strong>å³ä½¿æ²’æœ‰ä¸Šå‚³åœ–ç‰‡ï¼Œç³»çµ±ä¹Ÿæœƒæ ¹æ“šæ‚¨é¸æ“‡çš„å ´æ™¯ã€ä¸»è§’ã€æ™‚é–“å’Œé¡å¤–æè¿°ä¾†ç”Ÿæˆè±å¯Œçš„æç¤ºè©ï¼
            </div>
            <br>
            <button type="submit">ç”Ÿæˆæç¤ºè©</button>
        </form>
        <hr>
        {% if image_url %}
        <div>
            <h3>å·²ä¸Šå‚³åœ–ç‰‡ï¼š</h3>
            <img src="{{ image_url }}" alt="ä¸Šå‚³åœ–ç‰‡" style="max-width:300px;">
        </div>
        {% endif %}
        {% if prompt_text %}
        <div>
            <h2>ç”Ÿæˆçš„æç¤ºè©ï¼ˆæ–‡æœ¬ï¼‰</h2>
            <textarea id="promptTextArea" readonly style="width:100%;height:140px;">{{ prompt_text }}</textarea>
            <div class="button-container">
                <a href="/download_prompt?prompt={{ prompt_text }}" download>ä¸‹è¼‰æ–‡æœ¬</a>
                <button type="button" id="copyTextBtn">è¤‡è£½å…¨éƒ¨æ–‡æœ¬</button>
            </div>
        </div>
        {% endif %}
        {% if prompt_json %}
        <div>
            <h2>ç”Ÿæˆçš„æç¤ºè©ï¼ˆJSONï¼‰</h2>
            <textarea id="promptJsonArea" readonly style="width:100%;height:180px;">{{ prompt_json_str }}</textarea>
            <div class="button-container">
                <a href="/download_json?prompt_json={{ prompt_json_str|urlencode }}" download>ä¸‹è¼‰ JSON</a>
                <button type="button" id="copyJsonBtn">è¤‡è£½å…¨éƒ¨ JSON</button>
            </div>
        </div>
        {% endif %}
        <div>
            <button id="shareDriveBtn">åˆ†äº«è‡³ Google Drive</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
